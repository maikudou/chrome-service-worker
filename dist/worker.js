(()=>{"use strict";var e;!function(e){e.isWelcomeMessage=function(e){return"welcome"===e.type},e.isPongMessage=function(e){return"pong"===e.type},e.isSocketMessage=function(e){return"socket"===e.type},e.isMirrorMessage=function(e){return"mirror"===e.type},e.isStartSessionMessage=function(e){return"startSession"===e.type},e.isPingMessage=function(e){return"ping"===e.type},e.isSocketSendMessage=function(e){return"socketSend"===e.type}}(e||(e={}));function n(e,n){e.postMessage(JSON.stringify(n))}console.log("I am a worker"),chrome.runtime.onConnect.addListener((s=>{console.log("New incoming connection",s.name),n(s,{type:"welcome",message:"Hey, welcome"}),s.onMessage.addListener((t=>{const o=JSON.parse(t);o&&function(s,t){e.isPingMessage(t)?n(s,{type:"pong"}):e.isStartSessionMessage(t)?async function(s){const t=await new Promise(((e,n)=>{const s=new WebSocket("wss://echo.websocket.org");s.addEventListener("open",(n=>{e(s)})),s.addEventListener("error",(e=>{n(s)}))}));t.addEventListener("message",(e=>{!function(e,s){n(e,{type:"socket",data:s})}(s,e.data)})),s.onMessage.addListener((n=>{const s=JSON.parse(n);s&&function(n,s){e.isSocketSendMessage(s)&&n.send(s.message)}(t,s)}))}(s):n(s,{type:"mirror",message:`Get it back: ${JSON.stringify(t)}`})}(s,o)}))}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9jaHJvbWUtc2VydmljZS13b3JrZXIvLi9zcmMvdHlwZXMudHMiLCJ3ZWJwYWNrOi8vY2hyb21lLXNlcnZpY2Utd29ya2VyLy4vc3JjL3dvcmtlci50cyJdLCJuYW1lcyI6WyJNZXNzYWdlIiwiaXNXZWxjb21lTWVzc2FnZSIsIm1lc3NhZ2UiLCJ0eXBlIiwiaXNQb25nTWVzc2FnZSIsImlzU29ja2V0TWVzc2FnZSIsImlzTWlycm9yTWVzc2FnZSIsImlzU3RhcnRTZXNzaW9uTWVzc2FnZSIsImlzUGluZ01lc3NhZ2UiLCJpc1NvY2tldFNlbmRNZXNzYWdlIiwicG9zdE1lc3NhZ2VUb1BvcnQiLCJwb3J0IiwicG9zdE1lc3NhZ2UiLCJKU09OIiwic3RyaW5naWZ5IiwiY29uc29sZSIsImxvZyIsImNocm9tZSIsInJ1bnRpbWUiLCJvbkNvbm5lY3QiLCJhZGRMaXN0ZW5lciIsIm5hbWUiLCJvbk1lc3NhZ2UiLCJwYXJzZWRNZXNzYWdlIiwicGFyc2UiLCJhc3luYyIsImNvbm5lY3Rpb24iLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsIndzIiwiV2ViU29ja2V0IiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50IiwiZGF0YSIsInByb2Nlc3NTb2NrZXRNZXNzYWdlIiwic29ja2V0Iiwic2VuZCIsInByb2Nlc3NQb3J0U29ja2V0TWVzc2FnZSIsImluaXRTb2NrZXQiLCJwcm9jZXNzUG9ydE1lc3NhZ2UiXSwibWFwcGluZ3MiOiJtQkF3Q08sSUFBVUEsR0FBakIsU0FBaUJBLEdBQ0MsRUFBQUMsaUJBQWhCLFNBQWlDQyxHQUMvQixNQUF3QixZQUFqQkEsRUFBUUMsTUFFRCxFQUFBQyxjQUFoQixTQUE4QkYsR0FDNUIsTUFBd0IsU0FBakJBLEVBQVFDLE1BRUQsRUFBQUUsZ0JBQWhCLFNBQWdDSCxHQUM5QixNQUF3QixXQUFqQkEsRUFBUUMsTUFFRCxFQUFBRyxnQkFBaEIsU0FBZ0NKLEdBQzlCLE1BQXdCLFdBQWpCQSxFQUFRQyxNQUdELEVBQUFJLHNCQUFoQixTQUNFTCxHQUVBLE1BQXdCLGlCQUFqQkEsRUFBUUMsTUFFRCxFQUFBSyxjQUFoQixTQUE4Qk4sR0FDNUIsTUFBd0IsU0FBakJBLEVBQVFDLE1BRUQsRUFBQU0sb0JBQWhCLFNBQW9DUCxHQUNsQyxNQUF3QixlQUFqQkEsRUFBUUMsTUF2Qm5CLENBQWlCSCxNQUFPLEtDbEN4QixTQUFTVSxFQUFrQkMsRUFBMkJULEdBQ3BEUyxFQUFLQyxZQUFZQyxLQUFLQyxVQUFVWixJQUhsQ2EsUUFBUUMsSUFBSSxpQkFNWkMsT0FBT0MsUUFBUUMsVUFBVUMsYUFBWVQsSUFDbkNJLFFBQVFDLElBQUksMEJBQTJCTCxFQUFLVSxNQUU1Q1gsRUFBa0JDLEVBQU0sQ0FDdEJSLEtBQU0sVUFDTkQsUUFBUyxpQkFHWFMsRUFBS1csVUFBVUYsYUFBWWxCLElBQ3pCLE1BQU1xQixFQUFnQlYsS0FBS1csTUFBTXRCLEdBQzdCcUIsR0E2QlIsU0FBNEJaLEVBQTJCVCxHQUNqREYsRUFBUVEsY0FBY04sR0FDeEJRLEVBQWtCQyxFQUFNLENBQ3RCUixLQUFNLFNBRUNILEVBQVFPLHNCQUFzQkwsR0E1QjNDdUIsZUFBMEJkLEdBQ3hCLE1BQU1lLFFBQW1CLElBQUlDLFNBQW1CLENBQUNDLEVBQVNDLEtBQ3hELE1BQU1DLEVBQUssSUFBSUMsVUExQkEsNEJBMkJmRCxFQUFHRSxpQkFBaUIsUUFBUUMsSUFDMUJMLEVBQVFFLE1BRVZBLEVBQUdFLGlCQUFpQixTQUFTQyxJQUMzQkosRUFBT0MsU0FJWEosRUFBV00saUJBQWlCLFdBQVdDLEtBaUN6QyxTQUE4QnRCLEVBQTJCdUIsR0FDdkR4QixFQUFrQkMsRUFBTSxDQUN0QlIsS0FBTSxTQUNOK0IsU0FuQ0FDLENBQXFCeEIsRUFBTXNCLEVBQU1DLFNBR25DdkIsRUFBS1csVUFBVUYsYUFBWWxCLElBQ3pCLE1BQU1xQixFQUFnQlYsS0FBS1csTUFBTXRCLEdBQzdCcUIsR0FxQlIsU0FBa0NhLEVBQW1CbEMsR0FDL0NGLEVBQVFTLG9CQUFvQlAsSUFDOUJrQyxFQUFPQyxLQUFLbkMsRUFBUUEsU0F0QmxCb0MsQ0FBeUJaLEVBQVlILE1BV3ZDZ0IsQ0FBVzVCLEdBRVhELEVBQWtCQyxFQUFNLENBQ3RCUixLQUFNLFNBQ05ELFFBQVMsZ0JBQWdCVyxLQUFLQyxVQUFVWixPQXRDeENzQyxDQUFtQjdCLEVBQU1ZLFUiLCJmaWxlIjoid29ya2VyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGludGVyZmFjZSBNZXNzYWdlIHtcbiAgdHlwZTogc3RyaW5nXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgV2VsY29tZU1lc3NhZ2UgZXh0ZW5kcyBNZXNzYWdlIHtcbiAgdHlwZTogJ3dlbGNvbWUnXG4gIG1lc3NhZ2U6IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFBvbmdNZXNzYWdlIGV4dGVuZHMgTWVzc2FnZSB7XG4gIHR5cGU6ICdwb25nJ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFNvY2tldE1lc3NhZ2UgZXh0ZW5kcyBNZXNzYWdlIHtcbiAgdHlwZTogJ3NvY2tldCdcbiAgZGF0YTogYW55XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTWlycm9yTWVzc2FnZSBleHRlbmRzIE1lc3NhZ2Uge1xuICB0eXBlOiAnbWlycm9yJ1xuICBtZXNzYWdlOiBhbnlcbn1cblxuZXhwb3J0IHR5cGUgU2VydmVyTWVzc2FnZSA9IFdlbGNvbWVNZXNzYWdlIHwgUG9uZ01lc3NhZ2UgfCBTb2NrZXRNZXNzYWdlIHwgTWlycm9yTWVzc2FnZVxuXG5leHBvcnQgaW50ZXJmYWNlIFN0YXJ0U2Vzc2lvbk1lc3NhZ2UgZXh0ZW5kcyBNZXNzYWdlIHtcbiAgdHlwZTogJ3N0YXJ0U2Vzc2lvbidcbn1cblxuZXhwb3J0IGludGVyZmFjZSBQaW5nTWVzc2FnZSBleHRlbmRzIE1lc3NhZ2Uge1xuICB0eXBlOiAncGluZydcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTb2NrZXRTZW5kTWVzc2FnZSBleHRlbmRzIE1lc3NhZ2Uge1xuICB0eXBlOiAnc29ja2V0U2VuZCdcbiAgbWVzc2FnZTogc3RyaW5nXG59XG5cbmV4cG9ydCB0eXBlIENvbnRlbnRTY3JpcHRNZXNzYWdlID0gU3RhcnRTZXNzaW9uTWVzc2FnZSB8IFBpbmdNZXNzYWdlIHwgU29ja2V0U2VuZE1lc3NhZ2VcblxuZXhwb3J0IG5hbWVzcGFjZSBNZXNzYWdlIHtcbiAgZXhwb3J0IGZ1bmN0aW9uIGlzV2VsY29tZU1lc3NhZ2UobWVzc2FnZTogU2VydmVyTWVzc2FnZSk6IG1lc3NhZ2UgaXMgV2VsY29tZU1lc3NhZ2Uge1xuICAgIHJldHVybiBtZXNzYWdlLnR5cGUgPT09ICd3ZWxjb21lJ1xuICB9XG4gIGV4cG9ydCBmdW5jdGlvbiBpc1BvbmdNZXNzYWdlKG1lc3NhZ2U6IFNlcnZlck1lc3NhZ2UpOiBtZXNzYWdlIGlzIFBvbmdNZXNzYWdlIHtcbiAgICByZXR1cm4gbWVzc2FnZS50eXBlID09PSAncG9uZydcbiAgfVxuICBleHBvcnQgZnVuY3Rpb24gaXNTb2NrZXRNZXNzYWdlKG1lc3NhZ2U6IFNlcnZlck1lc3NhZ2UpOiBtZXNzYWdlIGlzIFNvY2tldE1lc3NhZ2Uge1xuICAgIHJldHVybiBtZXNzYWdlLnR5cGUgPT09ICdzb2NrZXQnXG4gIH1cbiAgZXhwb3J0IGZ1bmN0aW9uIGlzTWlycm9yTWVzc2FnZShtZXNzYWdlOiBTZXJ2ZXJNZXNzYWdlKTogbWVzc2FnZSBpcyBNaXJyb3JNZXNzYWdlIHtcbiAgICByZXR1cm4gbWVzc2FnZS50eXBlID09PSAnbWlycm9yJ1xuICB9XG5cbiAgZXhwb3J0IGZ1bmN0aW9uIGlzU3RhcnRTZXNzaW9uTWVzc2FnZShcbiAgICBtZXNzYWdlOiBDb250ZW50U2NyaXB0TWVzc2FnZVxuICApOiBtZXNzYWdlIGlzIFN0YXJ0U2Vzc2lvbk1lc3NhZ2Uge1xuICAgIHJldHVybiBtZXNzYWdlLnR5cGUgPT09ICdzdGFydFNlc3Npb24nXG4gIH1cbiAgZXhwb3J0IGZ1bmN0aW9uIGlzUGluZ01lc3NhZ2UobWVzc2FnZTogQ29udGVudFNjcmlwdE1lc3NhZ2UpOiBtZXNzYWdlIGlzIFBpbmdNZXNzYWdlIHtcbiAgICByZXR1cm4gbWVzc2FnZS50eXBlID09PSAncGluZydcbiAgfVxuICBleHBvcnQgZnVuY3Rpb24gaXNTb2NrZXRTZW5kTWVzc2FnZShtZXNzYWdlOiBDb250ZW50U2NyaXB0TWVzc2FnZSk6IG1lc3NhZ2UgaXMgU29ja2V0U2VuZE1lc3NhZ2Uge1xuICAgIHJldHVybiBtZXNzYWdlLnR5cGUgPT09ICdzb2NrZXRTZW5kJ1xuICB9XG59XG4iLCJpbXBvcnQgeyBTZXJ2ZXJNZXNzYWdlLCBDb250ZW50U2NyaXB0TWVzc2FnZSwgTWVzc2FnZSB9IGZyb20gJy4vdHlwZXMnXG5cbmNvbnN0IFNPQ0tFVF9VUkwgPSAnd3NzOi8vZWNoby53ZWJzb2NrZXQub3JnJ1xuXG5jb25zb2xlLmxvZygnSSBhbSBhIHdvcmtlcicpXG5cbmZ1bmN0aW9uIHBvc3RNZXNzYWdlVG9Qb3J0KHBvcnQ6IGNocm9tZS5ydW50aW1lLlBvcnQsIG1lc3NhZ2U6IFNlcnZlck1lc3NhZ2UpIHtcbiAgcG9ydC5wb3N0TWVzc2FnZShKU09OLnN0cmluZ2lmeShtZXNzYWdlKSlcbn1cblxuY2hyb21lLnJ1bnRpbWUub25Db25uZWN0LmFkZExpc3RlbmVyKHBvcnQgPT4ge1xuICBjb25zb2xlLmxvZygnTmV3IGluY29taW5nIGNvbm5lY3Rpb24nLCBwb3J0Lm5hbWUpXG5cbiAgcG9zdE1lc3NhZ2VUb1BvcnQocG9ydCwge1xuICAgIHR5cGU6ICd3ZWxjb21lJyxcbiAgICBtZXNzYWdlOiAnSGV5LCB3ZWxjb21lJ1xuICB9KVxuXG4gIHBvcnQub25NZXNzYWdlLmFkZExpc3RlbmVyKG1lc3NhZ2UgPT4ge1xuICAgIGNvbnN0IHBhcnNlZE1lc3NhZ2UgPSBKU09OLnBhcnNlKG1lc3NhZ2UpXG4gICAgaWYgKHBhcnNlZE1lc3NhZ2UpIHtcbiAgICAgIHByb2Nlc3NQb3J0TWVzc2FnZShwb3J0LCBwYXJzZWRNZXNzYWdlIGFzIENvbnRlbnRTY3JpcHRNZXNzYWdlKVxuICAgIH1cbiAgfSlcbn0pXG5cbmFzeW5jIGZ1bmN0aW9uIGluaXRTb2NrZXQocG9ydDogY2hyb21lLnJ1bnRpbWUuUG9ydCkge1xuICBjb25zdCBjb25uZWN0aW9uID0gYXdhaXQgbmV3IFByb21pc2U8V2ViU29ja2V0PigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgY29uc3Qgd3MgPSBuZXcgV2ViU29ja2V0KFNPQ0tFVF9VUkwpXG4gICAgd3MuYWRkRXZlbnRMaXN0ZW5lcignb3BlbicsIGV2ZW50ID0+IHtcbiAgICAgIHJlc29sdmUod3MpXG4gICAgfSlcbiAgICB3cy5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsIGV2ZW50ID0+IHtcbiAgICAgIHJlamVjdCh3cylcbiAgICB9KVxuICB9KVxuXG4gIGNvbm5lY3Rpb24uYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGV2ZW50ID0+IHtcbiAgICBwcm9jZXNzU29ja2V0TWVzc2FnZShwb3J0LCBldmVudC5kYXRhKVxuICB9KVxuXG4gIHBvcnQub25NZXNzYWdlLmFkZExpc3RlbmVyKG1lc3NhZ2UgPT4ge1xuICAgIGNvbnN0IHBhcnNlZE1lc3NhZ2UgPSBKU09OLnBhcnNlKG1lc3NhZ2UpXG4gICAgaWYgKHBhcnNlZE1lc3NhZ2UpIHtcbiAgICAgIHByb2Nlc3NQb3J0U29ja2V0TWVzc2FnZShjb25uZWN0aW9uLCBwYXJzZWRNZXNzYWdlIGFzIENvbnRlbnRTY3JpcHRNZXNzYWdlKVxuICAgIH1cbiAgfSlcbn1cblxuZnVuY3Rpb24gcHJvY2Vzc1BvcnRNZXNzYWdlKHBvcnQ6IGNocm9tZS5ydW50aW1lLlBvcnQsIG1lc3NhZ2U6IENvbnRlbnRTY3JpcHRNZXNzYWdlKSB7XG4gIGlmIChNZXNzYWdlLmlzUGluZ01lc3NhZ2UobWVzc2FnZSkpIHtcbiAgICBwb3N0TWVzc2FnZVRvUG9ydChwb3J0LCB7XG4gICAgICB0eXBlOiAncG9uZydcbiAgICB9KVxuICB9IGVsc2UgaWYgKE1lc3NhZ2UuaXNTdGFydFNlc3Npb25NZXNzYWdlKG1lc3NhZ2UpKSB7XG4gICAgaW5pdFNvY2tldChwb3J0KVxuICB9IGVsc2Uge1xuICAgIHBvc3RNZXNzYWdlVG9Qb3J0KHBvcnQsIHtcbiAgICAgIHR5cGU6ICdtaXJyb3InLFxuICAgICAgbWVzc2FnZTogYEdldCBpdCBiYWNrOiAke0pTT04uc3RyaW5naWZ5KG1lc3NhZ2UpfWBcbiAgICB9KVxuICB9XG59XG5cbmZ1bmN0aW9uIHByb2Nlc3NQb3J0U29ja2V0TWVzc2FnZShzb2NrZXQ6IFdlYlNvY2tldCwgbWVzc2FnZSkge1xuICBpZiAoTWVzc2FnZS5pc1NvY2tldFNlbmRNZXNzYWdlKG1lc3NhZ2UpKSB7XG4gICAgc29ja2V0LnNlbmQobWVzc2FnZS5tZXNzYWdlKVxuICB9XG59XG5cbmZ1bmN0aW9uIHByb2Nlc3NTb2NrZXRNZXNzYWdlKHBvcnQ6IGNocm9tZS5ydW50aW1lLlBvcnQsIGRhdGE6IGFueSkge1xuICBwb3N0TWVzc2FnZVRvUG9ydChwb3J0LCB7XG4gICAgdHlwZTogJ3NvY2tldCcsXG4gICAgZGF0YVxuICB9KVxufVxuIl0sInNvdXJjZVJvb3QiOiIifQ==